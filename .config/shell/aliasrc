# =============================================================================
#  Archivo de Alias y Funciones para Zsh
# =============================================================================
#
# ---
# ## 1. Configuraci√≥n de Comandos Base
# ---
# Establece el comportamiento por defecto de comandos esenciales.

# Usar Neovim (nvim) si est√° disponible.
if command -v nvim >/dev/null 2>&1; then
  alias vi='nvim'
  alias vim='nvim'
  alias vimdiff='nvim -d'
fi

# Par√°metros para comandos de manipulaci√≥n de archivos.
# -i: Interactivo (pregunta antes de sobreescribir).
# -v: Verbose (muestra lo que est√° haciendo).
# -I: Pregunta una vez antes de borrar m√°s de tres archivos.
# -p: Crea directorios padres si no existen.
alias cp='cp -iv'
alias mv='mv -iv'
alias rm='rm -vI'
alias mkd='mkdir -pv'
alias rsync='rsync -azh --info=progress2 --no-inc-recursive' # -azh es m√°s com√∫n que -vrPlu
alias bc='bc -ql'
alias ffmpeg='ffmpeg -hide_banner'

# ---
# ## 2. Comandos con Color y Formato Mejorado
# ---
# Mejora la legibilidad de la salida de varios comandos.

# Habilita el color para `ls`, `grep` y `diff`.
# La opci√≥n --color=auto es est√°ndar en la mayor√≠a de sistemas modernos.
alias ls='ls -hN --color=auto --group-directories-first'
alias grep='grep --color=auto'
alias diff='diff --color=auto'
alias ip='ip --color=auto'

# Resaltado de sintaxis con `highlight` (si est√° instalado).
if command -v highlight >/dev/null 2>&1; then
  alias ccat='highlight --out-format=ansi'
fi

# Listado de archivos mejorado.
# -l: Formato largo.
# -A: Muestra archivos ocultos (casi todos, excepto . y ..).
# -F: A√±ade un indicador de tipo de archivo (e.g., / para directorios).
# -r: Orden inverso (con -t, muestra los m√°s recientes al final).
# -t: Ordena por fecha de modificaci√≥n.
alias l='ls -lF'
alias la='ls -lAF'
alias ll='ls -lrthA' # Lista los archivos modificados m√°s recientemente al final.
alias lsd='ls -lF | grep --color=never "^d"' # Lista solo directorios.
alias lsf='ls -lF | grep --color=never "^-"'  # Lista solo archivos.

# ---
# ## 3. Gesti√≥n del Sistema y Privilegios
# ---

# Ejecutar comandos comunes de sistema con `sudo` autom√°ticamente.
# ¬°CUIDADO! Esto es conveniente, pero puede ser peligroso.
# Aseg√∫rate de que es el comportamiento que realmente deseas.
for cmd in mount umount sv pacman updatedb shutdown poweroff reboot; do
  alias $cmd="sudo $cmd"
done; unset cmd

# Atajos para gestores de paquetes (Arch y Void).
alias p='sudo pacman'
alias xi='sudo xbps-install'
alias xr='sudo xbps-remove -R'
alias xq='xbps-query'

# ---
# ## 4. Atajos y Abreviaciones Comunes
# ---
# Abreviaciones para comandos largos o de uso frecuente.

alias ka='killall'
alias g='git'
alias sdn='shutdown -h now'
alias z='zathura'
alias e='$EDITOR' # Abre el editor por defecto.
alias v='$EDITOR' # Alias alternativo para el editor.

# Recargar la configuraci√≥n del shell.
# Convertido a funci√≥n para mayor claridad.
ref() {
  echo "‚ôªÔ∏è Recargando configuraci√≥n del shell..."
  # Aqu√≠ puedes a√±adir los scripts que generen tus archivos de shortcuts si es necesario.
  # shortcuts >/dev/null
  source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutrc"
  source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutenvrc"
  source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/zshnameddirrc"
  echo "‚úÖ ¬°Listo!"
}


# ---
# ## 5. Funciones de Utilidad
# ---
# Funciones personalizadas para tareas espec√≠ficas.

# Crear un directorio y entrar en √©l.
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Editar un script personal de forma r√°pida.
# Usa fzf para seleccionar un script de tu directorio bin y lo abre con $EDITOR.
se() {
  local choice
  choice=$(find "${HOME}/.local/bin" -type f -printf '%P\n' | fzf --height=40% --border)
  if [[ -n "$choice" ]]; then
    "$EDITOR" "${HOME}/.local/bin/${choice}"
  fi
}

# Mostrar el PATH, una entrada por l√≠nea.
path() {
  echo -e "${PATH//:/\\n}"
}

# Mostrar puertos en uso.
ports() {
  ss -tulanp
}

# Mostrar puntos de montaje de forma legible.
mnt() {
  mount | awk '/^\/dev/ || /^\/\// {print $1, "on", $3, "type", $5}' | column -t | sort
}

# Informaci√≥n de fecha y hora.
alias week='date +%V'
alias tokudate='date +"%Y-%m-%d w%V.%u %H:%M"'

# ---
# ## 6. Docker
# ---
# Funciones y alias para facilitar el manejo de Docker y Docker Compose.

# Limpiar el sistema Docker (contenedores, im√°genes y vol√∫menes no usados).
dclean() {
  echo "üßπ Limpiando Docker..."
  docker container prune -f
  docker image prune -f
  docker volume prune -f
  docker network prune -f
  echo "‚úÖ Limpieza completada."
}

# Mostrar informaci√≥n clave de los contenedores en ejecuci√≥n (ID, Nombre, Imagen, IP).
# Esta versi√≥n es m√°s eficiente que la original, ya que usa el formato de `docker inspect`.
dip() {
  docker inspect --format '{{.Id}} {{.Name}} {{.Config.Image}} {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' $(docker ps -q) | \
  awk '{printf "%-12.12s %-30.30s %-30.30s %-20.20s\n", $1, substr($2,2), $3, $4}'
}

# Alias comunes de Docker.
alias dps='docker ps'
alias dpsa='docker ps -a'
alias dexe='docker exec -it' # A√±adido -it para sesiones interactivas.
alias dins='docker inspect'
alias dimg='docker images'
alias dlog='docker logs -f'
alias dsp='docker system prune --all --force' # Alias m√°s descriptivo.

# Alias de Docker Compose.
alias dc='docker-compose'
alias dcup='dc up -d' # A√±adido -d para modo detached por defecto.
alias dcdn='dc down' # Alias m√°s consistente (down -> dcdn).
alias dcl='dc logs -f' # Para ver logs.

# ---
# ## 7. Git y Gesti√≥n de Dotfiles
# ---

# Alias de Git generales
alias ga='git add'
alias gaa='git add .'
alias gc='git commit -m'
alias gca='git commit -am'
alias gs='git status'
alias gp='git push'
alias gpl='git pull'
alias gb='git branch'
alias gco='git checkout'
alias glog="git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"

# Alias para gestionar dotfiles con un repositorio git bare.
# Te permite hacer `config status`, `config add .zshrc`, etc. desde cualquier lugar.
alias config='/usr/bin/git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME'


# ---
# ## 8. Kubernetes (kubecolor)
# ---
# Usa kubecolor si est√° disponible para una salida m√°s clara.

if command -v kubecolor >/dev/null 2>&1; then alias k='kubecolor'; else alias k='kubectl'; fi

alias kg='k get'
alias kgp='kg pods'
alias kgpw='kg pods -o wide'
alias kgd='kg deployment'
alias kgs='kg service'
alias kgj='kg jobs'
alias kgn='kg ingress'

alias kapp='k apply -f'
alias kdel='k delete -f'
alias kdesc='k describe'
alias klog='k logs -f'

# ---
# ## 9. Redes e Informaci√≥n de Sistema
# ---

# Obtener IPs p√∫blica y privada.
whatsmyip() {
    local pub_ip
    pub_ip=$(curl -s ipinfo.io/ip)
    echo "üåç IP Externa: ${pub_ip}"
    echo "üíª IP Interna:"
    ip a | grep 'inet ' | awk '{print "   " $NF ": " $2}'
}

alias NetIntGW="ip r | grep default | cut -d' ' -f 3"
alias NetIntIPv4='hostname -I | cut -d" " -f1'

# Obtener informaci√≥n de la ventana o tecla presionada (requiere xorg-xprop y xorg-xev).
alias ventana="xprop | grep WM_CLASS"
alias tecla="xev | grep keysym"

# ---
# ## 10. Descargas y Multimedia
# ---
# Atajos para yt-dlp y transmission.

alias yt='yt-dlp --embed-metadata -i'
alias yta='yt-dlp -x --audio-format mp3 --audio-quality 0 -f bestaudio/best' # -x extrae audio.
alias ytt='yt-dlp --skip-download --write-thumbnail' # Descarga solo la miniatura.
alias trem='transmission-remote'
alias YT='youtube-viewer'
